<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>OceanSat Labs — Data Delivery</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Leaflet (Map) CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <!-- Flatpickr (Calendar) CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet">
  <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>

  <style>

    /* Scale-style accent: animated conic gradient, light stroke, soft glow */
    .hero-accent{
      background: conic-gradient(from 210deg at 50% 50%,
                  #a78bfa, #60a5fa, #22d3ee, #f472b6, #a78bfa);
      background-size: 200% 200%;
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;

      /* subtle definition so it doesn’t look “flat” */
      -webkit-text-stroke: 0.6px rgba(255,255,255,.22);
      text-shadow:
        0 0 24px rgba(147,112,219,.35),
        0 0 48px rgba(34,211,238,.18);

      animation: heroHue 12s ease-in-out infinite alternate;
    }
    @keyframes heroHue{
      0%{ background-position: 0% 50%; }
      100%{ background-position: 100% 50%; }
    }
    /* Respect reduced motion */
    @media (prefers-reduced-motion: reduce){
      .hero-accent{ animation: none; }
    }
    .flatpickr-alt { width: 100% !important; min-width: 0 !important; }

    /* Map containers */
    #leafletMapSheet { height:100%; min-height:320px; }
    .leaflet-container { background: #0a0a0a; }

    /* —— Hero —— */
    .hero{position:relative;min-height:110vh;overflow:hidden;background:#000}
    .hero .imgwrap{position:absolute;inset:0;overflow:hidden;z-index:0}
    .hero img{
      position:absolute;inset:0;width:100%;height:100%;object-fit:cover;
      object-position:50% 105%;
      transform-origin:center;
      animation:kenburns 48s ease-in-out infinite alternate;
      filter:saturate(1.05) contrast(1.05) brightness(.95);
    }
    @keyframes kenburns{0%{transform:scale(1.06) translateY(0%)}100%{transform:scale(1.09) translateY(-1.2%)}}

    #message { resize: vertical; }

    .cinema{position:absolute;inset:-8%;pointer-events:none;mix-blend-mode:screen;opacity:.35;filter:blur(10px);z-index:1}
    .cinema::before,.cinema::after{content:"";position:absolute;inset:0}
    .cinema::before{
      background:
        radial-gradient(90% 70% at 20% 10%, rgba(160,220,255,.18), transparent 60%),
        radial-gradient(100% 80% at 85% 35%, rgba(200,160,255,.16), transparent 60%);
      animation:driftA 60s ease-in-out infinite;
    }
    #message::placeholder {
    color: #ffffff91; /* light cyan */
    }
    .cinema::after{
      background:conic-gradient(from 0deg at 60% 15%, rgba(120,200,255,.10),
                 transparent 35%, rgba(200,160,255,.10) 65%, transparent 85%);
      transform-origin:60% 15%;
      animation:driftB 90s linear infinite;opacity:.45;
    }
    @keyframes driftA{0%{transform:translate3d(-1%,0,0) scale(1.02)}50%{transform:translate3d(1%,-1%,0) scale(1.03)}100%{transform:translate3d(-1%,0,0) scale(1.02)}}
    @keyframes driftB{to{transform:rotate(360deg) scale(1.02)}}

    .topfade{position:absolute;inset:0;background:linear-gradient(to bottom,rgba(0,0,0,.90),rgba(0,0,0,.45) 35%,rgba(0,0,0,0) 70%);z-index:2}
    .botfade{position:absolute;left:0;right:0;bottom:0;height:22vh;background:linear-gradient(to bottom,rgba(0,0,0,0),rgba(0,0,0,1));z-index:2}

    .grain{position:absolute;inset:0;pointer-events:none;opacity:.05;mix-blend-mode:soft-light;z-index:1;
      background-image:
        repeating-linear-gradient(0deg, rgba(255,255,255,.10) 0 1px, transparent 1px 2px),
        repeating-linear-gradient(90deg, rgba(255,255,255,.10) 0 1px, transparent 1px 2px);
      animation:grainShift 6s steps(2) infinite}
    @keyframes grainShift{50%{transform:translate3d(.6px,.6px,0)}}

    /* Glass card + subtle reflection */
    .glass-card{
      position: relative; overflow: hidden;
      backdrop-filter: blur(16px);
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: 1rem;
      box-shadow: 0 10px 40px rgba(0,0,0,0.35);
    }
    .glass-card.reflection::before{
      content:""; position:absolute; top:-35%; left:-20%;
      width:140%; height:60%;
      background: linear-gradient(to bottom, rgba(255,255,255,0.22), rgba(255,255,255,0));
      transform: rotate(-6deg); pointer-events:none;
    }

    #processingCard { background: transparent; }

    .icon{ opacity: 0; transform: scale(.96); animation: iconCycle 8s linear infinite; }
    .icon--discovery  { animation-delay: 0s; }
    .icon--subsetting { animation-delay: 2s; }
    .icon--reproject  { animation-delay: 4s; }
    .icon--export     { animation-delay: 6s; }
    @keyframes iconCycle{ 0% { opacity: 0; transform: scale(.96); } 5% { opacity: 1; transform: scale(1); } 20% { opacity: 1; transform: scale(1); } 25% { opacity: 0; transform: scale(1.04); } 100% { opacity: 0; transform: scale(1.04); } }
    @keyframes ants   { to { stroke-dashoffset: -12 } }
    @keyframes orbit  { to { transform: rotate(360deg); } }

    .urg { --pill-bg: rgba(255,255,255,.06); --pill-border: rgba(255,255,255,.18); --hover-bg: rgba(255,255,255,.14); }
    .urg-asap     { --pill-bg: rgba(255,159,67,.18);  --pill-border: rgba(255,159,67,.42);  --hover-bg: rgba(255,159,67,.22); }
    .urg-standard { --pill-bg: rgba(34,197,94,.18);   --pill-border: rgba(34,197,94,.42);   --hover-bg: rgba(34,197,94,.22); }
    .urg-norush   { --pill-bg: rgba(59,130,246,.18);  --pill-border: rgba(59,130,246,.42);  --hover-bg: rgba(59,130,246,.22); }
    .urg-btn{ background: var(--pill-bg); border: 1px solid var(--pill-border); color: #fff; backdrop-filter: blur(10px); }
    .urg-menu{ background: rgba(255,255,255,.08); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,.12); border-radius: .75rem; }
    .urg-opt { color: #fff; }
    .urg-opt.asap:hover     { background: rgba(255,159,67,.22); }
    .urg-opt.standard:hover { background: rgba(34,197,94,.22);  }
    .urg-opt.norush:hover   { background: rgba(59,130,246,.22); }
    .urg-open .urg-caret{ transform: rotate(180deg); }

    /* --- FIX: Prevent hero animation ONLY when map modal is open --- */
    .body--modal-open .hero img,
    .body--modal-open .cinema::before,
    .body--modal-open .cinema::after,
    .body--modal-open .grain {
      animation: none !important;
      transform: none !important;
    }
    
    body.modal-open { overflow: hidden; }
    .leaflet-control-container { z-index: 50 !important; }

    /* Custom Flatpickr Glassy Theme */
    .flatpickr-calendar { backdrop-filter: blur(16px); background: rgba(20, 20, 20, 0.75); border: 1px solid rgba(255, 255, 255, 0.18); border-radius: 0.75rem; box-shadow: 0 10px 40px rgba(0,0,0,0.35); color: #e5e7eb; }
    .flatpickr-months .flatpickr-month, .flatpickr-current-month .flatpickr-monthDropdown-months { color: #fff; fill: #fff; }
    .flatpickr-months .flatpickr-prev-month, .flatpickr-months .flatpickr-next-month { fill: #9ca3af; }
    .flatpickr-months .flatpickr-prev-month:hover svg, .flatpickr-months .flatpickr-next-month:hover svg { fill: #22d3ee; }
    span.flatpickr-weekday { color: #9ca3af; }
    .flatpickr-day { color: #d1d5db; }
    .flatpickr-day:hover, .flatpickr-day:focus { background: rgba(34,197,94, 0.22); border-color: transparent; }
    .flatpickr-day.today { border-color: #22d3ee; }
    .flatpickr-day.selected, .flatpickr-day.startRange, .flatpickr-day.endRange { background: #3b82f6; border-color: #3b82f6; color: #fff; }
    .flatpickr-day.inRange { background: rgba(59, 130, 246, 0.25); border-color: transparent; box-shadow: -5px 0 0 rgba(59, 130, 246, 0.25), 5px 0 0 rgba(59, 130, 246, 0.25); }
    .numInput, .numInputWrapper, .flatpickr-current-month input.cur-year { color: #fff; }
    .numInput:hover, .flatpickr-current-month input.cur-year:hover { background: rgba(255,255,255,0.1); }
    .flatpickr-day.disabled, .flatpickr-day.disabled:hover { color: rgba(255,255,255,0.2); }

    /* Urgency helper visibility */
    .urg-help { display: none; }
    .urg-help.show { display: block; }
  </style>
</head>
<body class="bg-black text-white">

 <!-- NAVBAR (non-fixed) -->
<header class="relative w-full bg-transparent">
  <div class="relative z-10 max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
    <a href="#hero" class="flex items-center gap-3">
      <img src="./earthlabs.png" alt="ODL logo" class="h-[48px] sm:h-[56px] md:h-[70px] w-auto object-contain" />
    </a>
    <nav class="space-x-8 text-sm">
      <a href="#about" class="hover:text-cyan-400 transition">How it works</a>
    </nav>
  </div>

  <div class="absolute inset-0 z-0 pointer-events-none bg-gradient-to-b from-black/50 to-transparent"></div>
</header>

  <!-- HERO -->
  <section class="hero" id="hero">
    <div class="imgwrap">
      <img src="Gemini_Generated_Image_epc5w4epc5w4epc5.jpg" alt="Earth from space"/>
    </div>
    <div class="topfade"></div>
    <div class="cinema"></div>
    <div class="grain"></div>
    <div class="botfade"></div>
    <div class="absolute inset-x-0 top-0 z-20" style="height: 400px; background: linear-gradient(to bottom, rgba(0,0,0,0.6), rgba(0,0,0,0));"></div>

    <div class="relative z-30 max-w-5xl mx-auto px-6 pt-20 md:pt-20 text-center">
      <h1 class="hero-title text-5xl md:text-7xl font-thin tracking-tight leading-tight text-white">
        Processed <span class="hero-accent">Satellite Data</span> - Delivered
      </h1>
      <p class="mt-8 text-2xl md:text-xl font-normal text-gray-100 max-w-4xl mx-auto">
        From plain language requests to Oceanographic Datasets — ready to use in your inbox.
      </p>

      <!-- FUSED REQUEST FORM -->
      <div class="mt-8 mx-auto max-w-6xl">
        <form id="request" action="https://formspree.io/f/xzzvqjyq" method="POST"
              class="glass-card reflection p-4 md:p-5 space-y-4 text-left min-h-[18rem]">

          <!-- Honeypot -->
          <input type="text" name="_gotcha" class="hidden" tabindex="-1" autocomplete="off"/>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <div>
              <label for="name" class="block text-white-300 mb-1 text-sm">Your name or alias</label>
              <input id="name" name="name" required class="w-full rounded-xl px-3 py-2 bg-white/5 border border-white/20 focus:outline-none focus:ring-2 focus:ring-cyan-400"/>
            </div>
            <div>
              <label for="email" class="block text-white-300 mb-1 text-sm">Email address</label>
              <input id="email" type="email" name="_replyto" required class="w-full rounded-xl px-3 py-2 bg-white/5 border border-white/20 focus:outline-none focus:ring-2 focus:ring-cyan-400"/>
            </div>
          </div>

          <div>
            <label for="message" class="block text-white-300 mb-1 text-sm">Describe the data you need</label>
            <textarea id="message" name="message" rows="2" required
                      class="w-full rounded-xl px-3 py-2 bg-white/5 border border-white/20 focus:outline-none focus:ring-2 focus:ring-cyan-400"
                      placeholder="Please be specific — include variable (e.g. Sea Surface Temperature), time range, area/coords, desired format (CSV, GeoTIFF, etc.), and any processing (e.g. monthly average, maps, trends etc.)."></textarea>
          </div>

          <!-- Date and Area Section -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <!-- Date Pickers -->
              <div>
                  <label class="block text-white-300 mb-1 text-sm">Time Range</label>
                  <div class="flex flex-col md:flex-row gap-3">
                      <input id="start_date" name="start_date" type="text" placeholder="Start Date" required
                            class="min-w-0 w-full rounded-xl px-3 py-2 bg-white/5 border border-white/20 focus:outline-none focus:ring-2 focus:ring-cyan-400"/>
                      <input id="end_date" name="end_date" type="text" placeholder="End Date" required
                            class="min-w-0 w-full rounded-xl px-3 py-2 bg-white/5 border border-white/20 focus:outline-none focus:ring-2 focus:ring-cyan-400"/>
                  </div>
              </div>

              <!-- Area Picker -->
              <div class="md:col-span-2">
                <label class="block text-white-300 mb-1 text-sm">Area of Interest</label>
                <div id="areaPreview" class="hidden mt-1 mb-2 rounded-xl border border-white/20 bg-white/5 backdrop-blur-sm overflow-hidden">
                    <div class="flex items-center justify-between px-3 py-2">
                        <span class="text-xs text-white-300">Selected Area</span>
                        <button id="editAreaBtn" type="button" class="text-xs text-cyan-300 hover:text-cyan-200 underline">Edit on map</button>
                    </div>
                    <div class="px-3 py-2 text-xs text-gray-300 border-t border-white/10">
                        <span id="bboxLabelInline">—</span>
                    </div>
                </div>
                 <!-- Button Group -->
                <div class="flex items-center gap-3 flex-wrap">
                    <button id="openAreaPicker" type="button" class="inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium bg-white/10 hover:bg-white/20 transition">
                        Draw Area on Map
                    </button>
                    <button id="openCoordsForm" type="button" class="inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium bg-white/10 hover:bg-white/20 transition">
                      Add Coordinates Manually
                    </button>
                </div>

                <div id="coordsForm" class="hidden mt-4 rounded-xl border border-white/20 bg-white/5 p-3">
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-3 items-start">
                    <!-- LEFT: fields -->
                    <div class="space-y-2">
                      <div class="grid grid-cols-2 gap-2">
                        <div>
                          <label class="text-xs">West Lon (°)</label>
                          <input id="coordLonW" type="number" step="0.0001" min="-180" max="180"
                                class="w-full rounded-xl px-2 py-1 bg-black/30 border border-white/20">
                        </div>
                        <div>
                          <label class="text-xs">East Lon (°)</label>
                          <input id="coordLonE" type="number" step="0.0001" min="-180" max="180"
                                class="w-full rounded-xl px-2 py-1 bg-black/30 border border-white/20">
                        </div>
                        <div>
                          <label class="text-xs">South Lat (°)</label>
                          <input id="coordLatS" type="number" step="0.0001" min="-90" max="90"
                                class="w-full rounded-xl px-2 py-1 bg-black/30 border border-white/20">
                        </div>
                        <div>
                          <label class="text-xs">North Lat (°)</label>
                          <input id="coordLatN" type="number" step="0.0001" min="-90" max="90"
                                class="w-full rounded-xl px-2 py-1 bg-black/30 border border-white/20">
                        </div>
                      </div>

                      <p id="coordsError" class="text-xs text-red-300 hidden"></p>

                      <div class="flex gap-2 flex-wrap">
                        <button id="useCoordsBtn" type="button"
                                class="px-3 py-1.5 text-sm rounded bg-white/10 hover:bg-white/20">
                          Use these coordinates
                        </button>
                         <button id="clearCoordsBtn" type="button" class="px-3 py-1.5 text-sm rounded bg-white/10 hover:bg-white/20">
                          Clear
                        </button>
                        <button id="cancelCoordsBtn" type="button"
                                class="px-3 py-1.5 text-sm rounded bg-white/10 hover:bg-white/20">
                          Cancel
                        </button>
                      </div>
                    </div>

                    <!-- RIGHT: live map -->
                    <div>
                      <div id="coordsMap" class="rounded-xl border border-white/10" style="height:240px;"></div>
                      <p class="mt-1 text-xs text-white/50">Live preview</p>
                    </div>
                  </div>
                </div>
              </div>
          </div>
          
          <input type="hidden" id="area_bbox_cardinal" name="area_bbox_cardinal" />
          <input type="hidden" id="area_bbox" name="area_bbox" />

          <!-- Controls: urgency + actions -->
          <div class="mt-4 grid grid-cols-1 sm:grid-cols-[auto,1fr] items-center gap-4">
            <div class="justify-self-center sm:justify-self-start">
              <div id="urgencySelect" class="urg urg-standard relative inline-block flex-shrink-0">
                <input type="hidden" name="urgency" id="urgVal" value="Standard (~7 days)"/>
                <button type="button" class="urg-btn inline-flex items-center gap-2 rounded-xl px-4 py-2 font-medium cursor-pointer shadow hover:opacity-95 transition">
                  <span class="urg-label">Standard (~7 days)</span>
                  <svg class="urg-caret w-4 h-4 transition-transform" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.06l3.71-3.83a.75.75 0 111.08 1.04l-4.25 4.39a.75.75 0 01-1.08 0L5.21 8.27a.75.75 0 01.02-1.06z" clip-rule="evenodd"/></svg>
                </button>
                <ul id="urgMenu" class="urg-menu absolute left-0 mt-2 w-56 rounded-xl p-1 shadow-xl hidden">
                  <li class="urg-opt asap rounded-lg px-3 py-2 text-sm cursor-pointer" data-value="ASAP">ASAP</li>
                  <li class="urg-opt standard rounded-lg px-3 py-2 text-sm cursor-pointer" data-value="Standard (~7 days)">Standard (~7 days)</li>
                  <li class="urg-opt norush rounded-lg px-3 py-2 text-sm cursor-pointer" data-value="No rush">No rush</li>
                </ul>
              </div>
              <!-- ***** NEW: Urgency helper ***** -->
              <div class="mt-2 text-xs text-gray-300">
                <button id="urgHelpToggle" type="button" class="underline text-cyan-300 hover:text-cyan-200">
                  How to choose urgency
                </button>
                <div id="urgHelp" class="urg-help mt-2 rounded-lg border border-white/10 bg-white/5 p-3">
                  <ul class="list-disc list-inside space-y-1">
                    <li><span class="font-semibold">ASAP</span>: time-critical or event-driven requests. We’ll prioritize this first.</li>
                    <li><span class="font-semibold">Standard (~7 days)</span>: default path; typical turnaround for most requests.</li>
                    <li><span class="font-semibold">No rush</span>: flexible delivery window; we’ll batch with other jobs.</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <div class="sm:col-span-1 flex justify-center sm:justify-end gap-3 flex-nowrap">
              <input type="hidden" name="_subject" id="subject" value="TerraScope request"/>
              <button id="submitBtn" type="submit" class="inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-semibold bg-gradient-to-r from-cyan-400 to-blue-500 hover:opacity-90 transition">
                Submit Request
              </button>
              <button type="button" id="clearBtn" class="inline-flex items-center justify-center px-5 py-2.5 rounded-xl font-medium bg-white/10 hover:bg-white/20 transition">
                Clear
              </button>
            </div>
          </div>
        </form>

        <!-- SUBMITTED / SUCCESS CARD -->
        <div id="processingCard" class="hidden glass-card reflection p-8 mt-6 flex flex-col items-center justify-center text-center min-h-[18rem]">
            <svg class="w-16 h-16 text-green-400 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <h3 class="text-3xl font-semibold text-white">Request Submitted!</h3>
            <p class="mt-4 text-gray-300 max-w-md">
              Thank you for your request. We've received it and will begin processing shortly. A confirmation and a quote will be sent to your email.
            </p>
        </div>
      </div>
    </div>
  </section>

  <!-- LOGO STRIP -->
  <section class="bg-black py-8">
    <p class="text-center text-gray-400 text-xs md:text-sm tracking-wider mb-5">Data Sources & Technology We Use</p>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6 md:gap-8 w-full">
      <div class="flex items-center justify-center h-16 md:h-20"><img src="./logos/google.png" alt="Google" class="max-h-12 md:max-h-14 w-auto object-contain opacity-90" loading="lazy"></div>
      <div class="flex items-center justify-center h-16 md:h-20"><img src="./logos/nasa.png" alt="Nasa" class="max-h-12 md:max-h-14 w-auto object-contain opacity-90" loading="lazy"></div>
      <div class="flex items-center justify-center h-16 md:h-20"><img src="./logos/copernicus.png" alt="Copernicus" class="max-h-12 md:max-h-14 w-auto object-contain opacity-90" loading="lazy"></div>
      <div class="flex items-center justify-center h-16 md:h-20"><img src="./logos/esa.png" alt="ESA" class="max-h-12 md:max-h-14 w-auto object-contain opacity-90" loading="lazy"></div>
    </div>
  </section>

  <!-- ABOUT -->
  <section id="about" class="py-20 bg-transparent">
    <div class="max-w-5xl mx-auto px-6 text-center">
      <h3 class="text-3xl font-semibold text-cyan-400">How It Works</h3>
      <p class="mt-4 text-gray-400 max-w-2xl mx-auto">We translate plain-language requests into precise data pulls, process them, and deliver clean outputs (CSV, GeoTIFF, plots).</p>
      <div class="mt-12 grid gap-6 md:grid-cols-3">
        <!-- 1. Describe -->
        <div class="bg-white/5 p-6 rounded-xl text-left">
          <img src="./icons/terra1.png" alt="Globe Icon" class="block mx-auto w-20 h-20 mb-4 opacity-80">
          <h4 class="text-center font-semibold text-cyan-300 mb-1">1. Describe</h4>
          <p class="text-gray-400 text-sm">Tell us what variable, where, and when.</p>
          <ul class="mt-3 text-gray-300 text-sm list-disc list-inside space-y-1">
            <li><span class="font-medium">What:</span> variables/products (e.g., SST, chlorophyll, altimetry), units.</li>
            <li><span class="font-medium">Where:</span> draw on the map or give coords/CRS (optional).</li>
            <li><span class="font-medium">When:</span> start–end dates or event window.</li>
            <li><span class="font-medium">Cadence:</span> hourly, daily, weekly, monthly.</li>
            <li><span class="font-medium">Format:</span> CSV, GeoTIFF, shapefile; any size/cloud limits.</li>
          </ul>
        </div>

        <!-- 2. Prepare -->
        <div class="bg-white/5 p-6 rounded-xl text-left">
          <img src="./icons/terra2.png" alt="Globe Icon" class="block mx-auto w-20 h-20 mb-4 opacity-80">
          <h4 class="text-center font-semibold text-cyan-300 mb-1">2. Prepare</h4>
          <p class="text-gray-400 text-sm">We source, subset, reproject, and format.</p>
          <ul class="mt-3 text-gray-300 text-sm list-disc list-inside space-y-1">
            <li><span class="font-medium">Source & check:</span> best-fit datasets; coverage & quality.</li>
            <li><span class="font-medium">Clean:</span> QC flags, cloud/land/ice masks, de-striping where needed.</li>
            <li><span class="font-medium">Subset & transform:</span> area crop, reprojection, resampling.</li>
            <li><span class="font-medium">Aggregate:</span> stats over time (mean, max, anomalies), mosaics/merges.</li>
            <li><span class="font-medium">Visualize:</span> quick-look maps/plots for sanity checks.</li>
          </ul>
        </div>

        <!-- 3. Deliver -->
        <div class="bg-white/5 p-6 rounded-xl text-left">
          <img src="./icons/terra3.png" alt="Globe Icon" class="block mx-auto w-20 h-20 mb-4 opacity-80">
          <h4 class="text-center font-semibold text-cyan-300 mb-1">3. Deliver</h4>
          <p class="text-gray-400 text-sm">Receive clean files + a short data brief.</p>
          <ul class="mt-3 text-gray-300 text-sm list-disc list-inside space-y-1">
            <li><span class="font-medium">Outputs:</span> CSV/GeoTIFF (+ figures/maps if requested).</li>
            <li><span class="font-medium">Metadata:</span> provenance, CRS, units, processing steps.</li>
            <li><span class="font-medium">Notes:</span> caveats, QC notes, and how to reproduce.</li>
            <li><span class="font-medium">Handover:</span> link by email; optional shared drive.</li>
          </ul>
        </div>
      </div>
    </div>
  </section>

<!-- ORBIT ANIMATION SECTION -->
  <section class="relative bg-transparent h-56 overflow-hidden -mt-32">
      <div class="absolute inset-0">
          <canvas id="orbitCanvas"></canvas>
      </div>
  </section>


<!-- UNIFIED FOOTER & WAVE SECTION (Fully Responsive) -->
  <section class="relative h-[50vh] -mt-24 overflow-hidden"> <!-- 1. The "Stage" is now 70% of the viewport height -->

    <!-- 2. The Canvas Wrapper sits at the bottom, taking up a proportional height -->
    <div class="absolute bottom-0 left-0 right-0 h-[50vh]">
      <!-- Canvas fills the wrapper, which is now also responsive -->
      <canvas id="waveCanvas" class="absolute inset-0 w-full h-full z-0"></canvas>
    </div>

    <!-- Footer Content (no changes needed here) -->
    <footer class="absolute bottom-0 left-0 right-0 z-10 bg-gradient-to-t from-black via-black/60 to-transparent pt-32 pb-8 text-center text-gray-400 text-sm">
      <span class="inline-block px-6 py-3 bg-black/30 backdrop-blur-md border border-white/10 rounded-full">
        © 2025 OceanSat Labs. All rights reserved.
      </span>
    </footer>

  </section>

<!-- MAP MODAL -->
<div id="mapModal" class="fixed inset-0 z-[100] flex items-center justify-center hidden">
  <div id="mapModalBackdrop" class="absolute inset-0 bg-black/60 backdrop-blur-sm"></div>
  <div class="relative flex flex-col w-[90vw] h-[85vh] max-w-6xl max-h-[800px]
              rounded-2xl border border-white/20 bg-black/50 backdrop-blur-xl shadow-2xl overflow-hidden">
    <div class="flex items-center justify-between px-4 py-3 border-b border-white/10 flex-shrink-0">
      <h4 class="text-base font-semibold">Pick Area (draw a rectangle)</h4>
      <button id="closeModalBtn" type="button" class="px-3 py-1 text-sm bg-white/10 hover:bg-white/20 rounded">Close</button>
    </div>
    <div class="flex-grow relative">
      <div id="leafletMapSheet" class="absolute inset-0 w-full h-full"></div>
    </div>
    <div class="flex items-center justify-between gap-4 px-4 py-3 border-t border-white/10 flex-shrink-0">
      <div id="bboxLabel" class="text-xs text-gray-300 truncate">No selection yet.</div>
      <div class="flex gap-2">
        <button id="resetBbox" type="button" class="px-3 py-2 text-sm bg-white/10 hover:bg-white/20 rounded">Reset</button>
        <button id="useBbox" type="button" class="px-4 py-2 text-sm rounded-lg font-semibold bg-gradient-to-r from-cyan-400 to-blue-500 hover:opacity-90">
          Use this Area
        </button>
      </div>
    </div>
  </div>
</div>

<!-- SCRIPTS BEGIN HERE! -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

<!-- JS: Form, Map, and other Logic -->
<script>
window.addEventListener('DOMContentLoaded', () => {
  // ===== FORM SUBMISSION & URGENCY DROPDOWN =====
  const form = document.querySelector('form#request');
  if (!form) return;
  const btnEl = document.getElementById('submitBtn');
  const clearBtn = document.getElementById('clearBtn');
  const processing = document.getElementById('processingCard');
  const nameEl = document.getElementById('name');
  const emailEl = document.getElementById('email');
  const msgEl = document.getElementById('message');
  const subjEl = document.getElementById('subject');
  const statusEl = document.getElementById('statusText') || (() => { const p = document.createElement('p'); p.id = 'statusText'; p.className = 'text-sm text-red-300 mt-1'; form.appendChild(p); return p; })();
  const urgWrap = document.getElementById('urgencySelect');
  const urgBtn = urgWrap ? urgWrap.querySelector('.urg-btn') : null;
  let urgMenu = document.getElementById('urgMenu') || (urgWrap ? urgWrap.querySelector('.urg-menu') : null);
  const urgLabel = urgWrap ? urgWrap.querySelector('.urg-label') : null;
  const urgHidden = document.getElementById('urgVal');
  function setUrgency(val) {
    if (urgLabel) urgLabel.textContent = val;
    if (urgHidden) urgHidden.value = val;
    if (!urgWrap) return;
    urgWrap.classList.remove('urg-asap', 'urg-standard', 'urg-norush');
    if (val.startsWith('ASAP')) urgWrap.classList.add('urg-asap');
    else if (val.startsWith('No rush')) urgWrap.classList.add('urg-norush');
    else urgWrap.classList.add('urg-standard');
  }
  function ensurePortaled() { if (!urgMenu || urgMenu.dataset.portaled) return; document.body.appendChild(urgMenu); urgMenu.dataset.portaled = '1'; urgMenu.style.position = 'fixed'; urgMenu.style.zIndex = '214783647'; urgMenu.style.margin = '0'; }
  function updateMenuPosition() { if (!urgBtn || !urgMenu) return; const r = urgBtn.getBoundingClientRect(); urgMenu.style.left = Math.round(r.left) + 'px'; urgMenu.style.top = Math.round(r.bottom + 8) + 'px'; urgMenu.style.minWidth = Math.max(r.width, 224) + 'px'; }
  function openMenu() { ensurePortaled(); updateMenuPosition(); urgMenu.classList.remove('hidden'); urgWrap && urgWrap.classList.add('urg-open'); }
  function closeMenu() { if (!urgMenu) return; urgMenu.classList.add('hidden'); urgWrap && urgWrap.classList.remove('urg-open'); }
  if (urgBtn && urgMenu) {
    urgBtn.addEventListener('click', (e) => { e.stopPropagation(); if (urgMenu.classList.contains('hidden')) openMenu(); else closeMenu(); });
    document.addEventListener('click', (e) => { if (!urgWrap.contains(e.target) && !urgMenu.contains(e.target)) closeMenu(); });
    window.addEventListener('scroll', () => { if (!urgMenu.classList.contains('hidden')) updateMenuPosition(); }, { passive: true });
    window.addEventListener('resize', () => { if (!urgMenu.classList.contains('hidden')) updateMenuPosition(); });
    urgMenu.querySelectorAll('.urg-opt, .urg-item').forEach(li => { li.addEventListener('click', () => { setUrgency(li.getAttribute('data-value')); closeMenu(); }); });
    setUrgency(urgHidden?.value || 'Standard (2–3 days)');
  }
  
  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    statusEl.classList.add('hidden');
    if (btnEl) { btnEl.disabled = true; btnEl.textContent = 'Sending…'; }
    const who = (nameEl?.value || 'New request').trim();
    const urg = (urgHidden?.value || '').trim();
    if (subjEl) subjEl.value = `TerraScope request — ${who} (${urg})`;
    try {
      const res = await fetch(form.action, { method: 'POST', headers: { 'Accept': 'application/json' }, body: new FormData(form) });
      if (!res.ok) { const data = await res.json().catch(() => ({})); throw new Error(data?.error || 'Failed to submit. Please try again.'); }
      form.classList.add('hidden');
      processing.classList.remove('hidden');
    } catch (err) {
      statusEl.textContent = err.message || 'Network error. Please try again.';
      statusEl.classList.remove('hidden');
    } finally {
      if (btnEl) { btnEl.disabled = false; btnEl.textContent = 'Submit Request'; }
    }
  });

  // ===== Urgency helper toggle =====
  const urgHelpToggle = document.getElementById('urgHelpToggle');
  const urgHelp = document.getElementById('urgHelp');
  urgHelpToggle?.addEventListener('click', () => {
    urgHelp?.classList.toggle('show');
  });

  // ===== DATE PICKER (FLATPICKR) LOGIC =====
  const startDateEl = document.getElementById("start_date");
  const endDateEl   = document.getElementById("end_date");
  if (startDateEl && endDateEl) {
    const fpStart = flatpickr(startDateEl, {
      altInput: true,
      altInputClass:
        'flatpickr-alt w-full rounded-xl px-3 py-2 ' +
        'bg-white/5 border border-white/20 focus:outline-none focus:ring-2 focus:ring-cyan-400 placeholder-gray-300',
      altFormat: 'M j, Y',
      dateFormat: 'Y-m-d',
      onChange(selectedDates){ fpEnd.set('minDate', selectedDates[0]); }
    });
    const fpEnd = flatpickr(endDateEl, {
      altInput: true,
      altInputClass:
        'flatpickr-alt w-full rounded-xl px-3 py-2 ' +
        'bg-white/5 border border-white/20 focus:outline-none focus:ring-2 focus:ring-cyan-400 placeholder-gray-300',
      altFormat: 'M j, Y',
      dateFormat: 'Y-m-d'
    });
    }

    function initDatePickers() {
    const startEl = document.querySelector('#start_date');
    const endEl   = document.querySelector('#end_date');
    if (!startEl || !endEl) return;

    // Avoid double-binding if user reopens the panel
    if (!startEl._flatpickr) {
        window.fpStart = flatpickr(startEl, {
        altInput: true,
        altInputClass: 'flatpickr-alt min-w-0 w-full md:flex-1 rounded-xl px-3 py-2 bg-white/5 border border-white/20 focus:outline-none focus:ring-2 focus:ring-cyan-400 placeholder-gray-300',
        altFormat: 'M j, Y',
        dateFormat: 'Y-m-d',
        onChange(selected){ if (selected[0]) fpEnd.set('minDate', selected[0]); }
        });
    }

    if (!endEl._flatpickr) {
        window.fpEnd = flatpickr(endEl, {
        altInput: true,
        altInputClass: 'flatpickr-alt min-w-0 w-full md:flex-1 rounded-xl px-3 py-2 bg-white/5 border border-white/20 focus:outline-none focus:ring-2 focus:ring-cyan-400 placeholder-gray-300',
        altFormat: 'M j, Y',
        dateFormat: 'Y-m-d'
        });
    }
    }

    // Run after DOM is ready
    document.addEventListener('DOMContentLoaded', initDatePickers);

    // If the “Honeypot” section is revealed/inserted later, init again on open.
    // Adjust selectors to whatever toggles your section.
    document.querySelector('#Honeypot')?.addEventListener('toggle', initDatePickers);
    document.querySelector('[data-open-honeypot]')?.addEventListener('click', () => {
    // Wait for DOM to render the moved nodes
    setTimeout(initDatePickers, 0);
    });

  
  // ===== AREA PICKER (MODAL & STATE LOGIC) =====
  // --- Elements
  const openPickerBtn = document.getElementById("openAreaPicker");
  const useBboxBtn = document.getElementById("useBbox");
  const resetBboxBtn = document.getElementById("resetBbox");
  const bboxLabel = document.getElementById("bboxLabel");
  const previewWrap = document.getElementById("areaPreview");
  const previewLabel = document.getElementById("bboxLabelInline");
  const editAreaBtn = document.getElementById("editAreaBtn");
  const areaHidden = document.getElementById("area_bbox");
  const areaHiddenCard = document.getElementById("area_bbox_cardinal");
  const mapModal = document.getElementById("mapModal");
  const closeModalBtn = document.getElementById("closeModalBtn");
  const mapModalBackdrop = document.getElementById("mapModalBackdrop");
  
  // --- State Variables
  let map, drawn, drawControl, currentRect = null, bbox = null;

  // --- Utility Functions
  const round = n => Math.round(n * 10000) / 10000;
  const fmtLat = lat => `${Math.abs(lat).toFixed(4)}°${lat >= 0 ? 'N' : 'S'}`;
  const fmtLon = lon => `${Math.abs(lon).toFixed(4)}°${lon >= 0 ? 'E' : 'W'}`;

  // --- Core Map Functions
  function closeMapModal() { mapModal.classList.add("hidden"); document.body.classList.remove("modal-open", "body--modal-open"); }
  
  function initMapIfNeeded() {
    if (map) return;
    map = L.map("leafletMapSheet", { zoomControl: true });
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", { attribution: "&copy; OpenStreetMap", maxZoom: 19 }).addTo(map);
    map.setView([20, 0], 2);
    drawn = new L.FeatureGroup(); map.addLayer(drawn);
    drawControl = new L.Control.Draw({ draw: { polygon: false, polyline: false, circle: false, circlemarker: false, marker: false, rectangle: { shapeOptions: { color: "#22d3ee", weight: 2, opacity: 0.9, fillOpacity: 0.1 } } }, edit: { featureGroup: drawn, edit: true, remove: true } });
    map.addControl(drawControl);
    map.on(L.Draw.Event.CREATED, (e) => { if (currentRect) drawn.removeLayer(currentRect); currentRect = e.layer; drawn.addLayer(currentRect); updateBboxFromLeaflet(); try { const handler = drawControl?._toolbars?.draw?._modes?.rectangle?.handler; if (handler && handler.disable) handler.disable(); } catch (_) { } });
    map.on("draw:edited", updateBboxFromLeaflet);
    map.on("draw:deleted", () => { currentRect = null; bbox = null; bboxLabel.textContent = "No selection yet."; });
  }

  function updateBboxFromLeaflet() {
    if (!currentRect) return;
    const b = currentRect.getBounds(); const sw = b.getSouthWest(), ne = b.getNorthEast();
    bbox = { lonW: round(sw.lng), latS: round(sw.lat), lonE: round(ne.lng), latN: round(ne.lat) };
    updateFormUIFromBbox();
    prefillCoords?.(bbox);
    if (mlMap) drawOnCoordsMap(bbox);
  }

  function syncBboxToLeafletMap(b) {
      if (!map || !drawn) return;
      const bounds = [[b.latS, b.lonW], [b.latN, b.lonE]];
      drawn.clearLayers();
      currentRect = L.rectangle(bounds, { color: "#22d3ee", weight: 2, opacity: 0.9, fillOpacity: 0.1 });
      drawn.addLayer(currentRect);
      updateFormUIFromBbox();
  }
  
  function updateFormUIFromBbox() {
      if (!bbox) {
          areaHidden.value = ""; areaHiddenCard.value = "";
          previewWrap.classList.add("hidden");
          openPickerBtn.textContent = "Draw Area on Map";
          bboxLabel.textContent = "No selection yet.";
          return;
      }
      const numeric = `${bbox.lonW},${bbox.latS} to ${bbox.lonE},${bbox.latN}`;
      const cardinal = `${fmtLon(bbox.lonW)}, ${fmtLat(bbox.latS)} to ${fmtLon(bbox.lonE)}, ${fmtLat(bbox.latN)}`;
      areaHidden.value = numeric; areaHiddenCard.value = cardinal;
      bboxLabel.textContent = cardinal;
      previewLabel.textContent = cardinal;
      previewWrap.classList.remove("hidden");
      openPickerBtn.textContent = "Change Selected Area";
  }
  
  function openMapModal() {
    document.body.classList.add("modal-open", "body--modal-open");
    mapModal.classList.remove("hidden");
    initMapIfNeeded();
    if (bbox && !currentRect) {
        syncBboxToLeafletMap(bbox);
    }
    setTimeout(() => {
        if (map) {
            map.invalidateSize(true);
            if (currentRect) { map.fitBounds(currentRect.getBounds(), { padding: [50, 50] }); }
        }
    }, 50);
  }

  // --- Event Listeners for map modal
  resetBboxBtn?.addEventListener("click", () => { if (drawn) drawn.clearLayers(); currentRect = null; bbox = null; updateFormUIFromBbox(); });
  useBboxBtn?.addEventListener("click", () => { if (!bbox) { bboxLabel.textContent = "Draw a rectangle first."; return; } closeMapModal(); });
  openPickerBtn?.addEventListener("click", openMapModal);
  editAreaBtn?.addEventListener("click", openMapModal);
  closeModalBtn?.addEventListener("click", closeMapModal);
  mapModalBackdrop?.addEventListener("click", closeMapModal);

  // ===== Manual coordinates + MapLibre inline map =====
  const openCoordsForm  = document.getElementById("openCoordsForm");
  const coordsForm      = document.getElementById("coordsForm");
  const coordLonW       = document.getElementById("coordLonW");
  const coordLonE       = document.getElementById("coordLonE");
  const coordLatS       = document.getElementById("coordLatS");
  const coordLatN       = document.getElementById("coordLatN");
  const useCoordsBtn    = document.getElementById("useCoordsBtn");
  const cancelCoordsBtn = document.getElementById("cancelCoordsBtn");
  const clearCoordsBtn  = document.getElementById("clearCoordsBtn");
  const coordsError     = document.getElementById("coordsError");
  
  let mlMap, mlBounds, mlHasLayer = false;

  function prefillCoords(b) {
    if (!b) return;
    if (coordLonW) coordLonW.value = b.lonW;
    if (coordLonE) coordLonE.value = b.lonE;
    if (coordLatS) coordLatS.value = b.latS;
    if (coordLatN) coordLatN.value = b.latN;
  }
  
  function initCoordsMapIfNeeded() {
    if (mlMap || !document.getElementById("coordsMap")) return;
    mlMap = new maplibregl.Map({ container: "coordsMap", style: "https://demotiles.maplibre.org/style.json", center: [0, 20], zoom: 1.5, attributionControl: false });
    mlMap.addControl(new maplibregl.NavigationControl({ showCompass: false }), "top-left");
    mlMap.on("load", () => {
      const waterBlue = "#0ea5e9";
      try { mlMap.setPaintProperty("background", "background-color", waterBlue); } catch {}
      (mlMap.getStyle().layers || []).forEach(l => {
        if (l.type === "fill") { mlMap.setPaintProperty(l.id, "fill-color", (l.id || "").includes("water") ? waterBlue : "#ffffff"); }
      });
      mlMap.addSource("bbox", { type: "geojson", data: { type: "FeatureCollection", features: [] }});
      mlMap.addLayer({ id: "bbox-fill", type: "fill", source: "bbox", paint: { "fill-color": "#22d3ee", "fill-opacity": 0.12 }});
      mlMap.addLayer({ id: "bbox-line", type: "line", source: "bbox", paint: { "line-color": "#22d3ee", "line-width": 2 }});
      mlHasLayer = true;
      if (bbox) drawOnCoordsMap(bbox, true);
    });
    if (document.getElementById("coordsForm")) new ResizeObserver(() => queueCoordsMapRefresh()).observe(document.getElementById("coordsForm"));
  }

  function drawOnCoordsMap(b, fitNow = false) {
    if (!mlMap || !mlHasLayer) return;
    const poly = { type: "Feature", geometry: { type: "Polygon", coordinates: [[ [b.lonW, b.latS], [b.lonE, b.latS], [b.lonE, b.latN], [b.lonW, b.latN], [b.lonW, b.latS] ]] }, properties: {} };
    mlMap.getSource("bbox").setData({ type: "FeatureCollection", features: [poly] });
    mlBounds = new maplibregl.LngLatBounds([b.lonW, b.latS], [b.lonE, b.latN]);
    if (fitNow) mlMap.fitBounds(mlBounds, { padding: 14, animate: false });
  }

  function queueCoordsMapRefresh() {
    if (!mlMap) return;
    requestAnimationFrame(() => { mlMap.resize(); if (mlBounds) mlMap.fitBounds(mlBounds, { padding: 14, animate: false }); });
  }

  openCoordsForm?.addEventListener("click", () => {
    coordsForm?.classList.toggle("hidden");
    if (!coordsForm?.classList.contains("hidden")) {
      initCoordsMapIfNeeded();
      setTimeout(queueCoordsMapRefresh, 80);
      if (bbox) { prefillCoords(bbox); drawOnCoordsMap(bbox, true); }
    }
  });
  cancelCoordsBtn?.addEventListener("click", () => coordsForm?.classList.add("hidden"));

  function handleLiveCoordPreview() {
    const W = parseFloat(coordLonW.value), E = parseFloat(coordLonE.value), S = parseFloat(coordLatS.value), N = parseFloat(coordLatN.value);
    if ([W, E, S, N].every(Number.isFinite)) {
      const previewBbox = { lonW: W, lonE: E, latS: S, latN: N };
      drawOnCoordsMap(previewBbox, true);
      coordsError.classList.add("hidden");
    }
  }

  [coordLonW, coordLonE, coordLatS, coordLatN].forEach(el => el?.addEventListener('input', handleLiveCoordPreview));

  useCoordsBtn?.addEventListener("click", () => {
    const W = parseFloat(coordLonW.value), E = parseFloat(coordLonE.value), S = parseFloat(coordLatS.value), N = parseFloat(coordLatN.value);
    if (![W, E, S, N].every(Number.isFinite)) {
      coordsError.textContent = "Please provide four valid coordinate numbers.";
      coordsError.classList.remove("hidden");
      return;
    }
    coordsError.classList.add("hidden");
    const normalizedBbox = { lonW: round(Math.min(W, E)), lonE: round(Math.max(W, E)), latS: round(Math.min(S, N)), latN: round(Math.max(S, N)) };
    bbox = normalizedBbox;
    prefillCoords(bbox);
    updateFormUIFromBbox();
    syncBboxToLeafletMap(bbox);
    coordsForm?.classList.add("hidden");
  });

  clearCoordsBtn?.addEventListener("click", () => {
    coordLonW.value = ''; coordLonE.value = ''; coordLatS.value = ''; coordLatN.value = '';
    coordsError.classList.add('hidden');
    if (mlMap && mlHasLayer) mlMap.getSource("bbox").setData({ type: "FeatureCollection", features: [] });
  });

  // ===== Main Clear Button with Confirmation =====
  if (clearBtn) {
    clearBtn.addEventListener('click', () => {
      if (confirm("Are you sure you want to clear the entire form?")) {
        form.reset();
        setUrgency('Standard (2–3 days)');
        statusEl.textContent = '';
        statusEl.classList.add('hidden');
        // Reset map state
        bbox = null;
        if (drawn) drawn.clearLayers();
        currentRect = null;
        updateFormUIFromBbox();
      }
    });
  }
});
</script>
<!-- Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<!-- ORBITER SCRIPT - FINAL -->
<script>
  (function initOrbitAnimation() {
    const canvas = document.getElementById('orbitCanvas');
    if (!canvas) return;

    // Scene setup with an orthographic camera for a 2D look
    const scene = new THREE.Scene();
    const frustumSize = 10;
    const camera = new THREE.OrthographicCamera();
    camera.position.z = 10;

    const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true, alpha: true });
    renderer.setClearColor(0x000000, 0);

    // --- Create reusable objects ---
    let orbitPath, satelliteSprite;
    const curve = new THREE.QuadraticBezierCurve3();

    // 1. The satellite sprite from a PNG
    // IMPORTANT: You must have an image named 'satellite.png' in the same folder as this HTML file.
    const textureLoader = new THREE.TextureLoader();
    const satelliteTexture = textureLoader.load(
        './icons/s2f.png',
        () => {}, // onLoad callback
        undefined, // onProgress callback
        (err) => { console.error('An error occurred loading the satellite texture.'); } // onError callback
    );
    const satelliteMaterial = new THREE.SpriteMaterial({ map: satelliteTexture });
    satelliteSprite = new THREE.Sprite(satelliteMaterial);
    satelliteSprite.scale.set(1.5, 1.5, 1.5); // Adjust size as needed
    scene.add(satelliteSprite);


    // 2. The curved yellow orbit path (placeholder geometry)
    const pathGeometry = new THREE.BufferGeometry();
    const pathMaterial = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0 });
    orbitPath = new THREE.Line(pathGeometry, pathMaterial);
    scene.add(orbitPath);

    // --- Handlers ---
    function onResize() {
        const container = canvas.parentElement;
        if (!container) return;
        const width = container.clientWidth;
        const height = container.clientHeight;
        
        renderer.setSize(width, height);

        const aspect = width / height;
        camera.left = frustumSize * aspect / -2;
        camera.right = frustumSize * aspect / 2;
        camera.top = frustumSize / 2;
        camera.bottom = frustumSize / -2;
        camera.updateProjectionMatrix();
        
        // Update the curve to span the full width of the camera view
        const edgeX = camera.right; // Use the exact camera edge
        const arcHeight = 1.5;      // Lower peak for a flatter arc
        const startY = -3.0;        // Lower start/end for a wider feel

        curve.v0.set(-edgeX, startY, 0);
        curve.v1.set(0, arcHeight, 0); // Control point (peak)
        curve.v2.set(edgeX, startY, 0);

        const points = curve.getPoints(50);
        orbitPath.geometry.setFromPoints(points);
    }

    // Use ResizeObserver for reliable container resizing detection
    new ResizeObserver(onResize).observe(canvas.parentElement);
    onResize(); // Initial call to set size and curve

    // --- Animation Loop ---
    function animate(time) {
      requestAnimationFrame(animate);

      // Loop a value 't' from 0.0 to 1.0
      const t = (time * 0.0001) % 1;

      // Get the position on the curve and apply it to the satellite
      const positionOnCurve = curve.getPointAt(t);
      satelliteSprite.position.copy(positionOnCurve);
      
      renderer.render(scene, camera);
    }
    animate();
  })();
</script>

<!-- WAVES SCRIPT - CORRECTED -->
<script>
  // -------- Perlin noise 3D (tiny impl) ----
  (function initPerlin(){
    const p = new Uint8Array(256);
    for (let i=0;i<256;i++) p[i]=i;
    for (let i=255;i>0;i--) { const j=(Math.random()*(i+1))|0; const t=p[i]; p[i]=p[j]; p[j]=t; }
    const perm = new Uint8Array(512);
    for (let i=0;i<512;i++) perm[i]=p[i&255];
    const fade = t => t*t*t*(t*(t*6-15)+10);
    const lerp = (t,a,b) => a + t*(b-a);
    const grad = (h,x,y,z) => {
      const u = (h&15) < 8 ? x : y;
      const v = (h&15) < 4 ? y : (h&15)===12 || (h&15)===14 ? x : z;
      return ((h&1)?-u:u) + ((h&2)?-v:v);
    };
    window.perlin3 = function(x,y,z){
      let X = Math.floor(x)&255, Y=Math.floor(y)&255, Z=Math.floor(z)&255;
      x -= Math.floor(x); y -= Math.floor(y); z -= Math.floor(z);
      const u=fade(x), v=fade(y), w=fade(z);
      const A=perm[X]+Y,  AA=perm[A]+Z,  AB=perm[A+1]+Z;
      const B=perm[X+1]+Y,BA=perm[B]+Z,  BB=perm[B+1]+Z;
      return lerp(w,
        lerp(v,
          lerp(u, grad(perm[AA],   x,   y,   z),
                   grad(perm[BA],   x-1, y,   z)),
          lerp(u, grad(perm[AB],   x,   y-1, z),
                   grad(perm[BB],   x-1, y-1, z))
        ),
        lerp(v,
          lerp(u, grad(perm[AA+1], x,   y,   z-1),
                   grad(perm[BA+1], x-1, y,   z-1)),
          lerp(u, grad(perm[AB+1], x,   y-1, z-1),
                   grad(perm[BB+1], x-1, y-1, z-1))
        )
      );
    };
  })();

  // --- Wave Script ---
  (function(){
    // -------- Knobs ----------------
    const GRID_SIZE = 220;
    const SEGMENTS  = 120;
    const AMP       = 4.0;
    const FREQ      = 0.05;
    const FLOW      = 0.04;

    const canvas = document.getElementById('waveCanvas');
    if (!canvas) return;
    const wrapper = canvas.parentElement;

    // -------- Scene Setup ----------------
    const scene    = new THREE.Scene();
    const camera   = new THREE.PerspectiveCamera(60, wrapper.clientWidth / wrapper.clientHeight, 0.1, 4000);
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:true });

    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.setSize(wrapper.clientWidth, wrapper.clientHeight);
    renderer.setClearColor(0x000000, 0); // Transparent background

    const HALF  = GRID_SIZE * 0.5;
    const focus = new THREE.Vector3(-HALF, 4, HALF);
    const camDir = new THREE.Vector3(-1, 0.3, 1).normalize();
    let   camDist = 100;

    function placeCam() {
      camera.position.copy(focus).add(camDir.clone().multiplyScalar(camDist));
      camera.lookAt(focus);
    }
    placeCam();

    // -------- Waves with Algal Bloom Shader ------------------------
    const geom = new THREE.PlaneGeometry(GRID_SIZE, GRID_SIZE, SEGMENTS, SEGMENTS);
    geom.rotateX(-Math.PI/2);
    
    const vertexShader = `
      varying vec3 v_world_pos;
      varying float v_height;
      void main() {
        vec4 world_pos = modelMatrix * vec4(position, 1.0);
        v_height = world_pos.y;
        v_world_pos = world_pos.xyz;
        gl_Position = projectionMatrix * viewMatrix * world_pos;
      }
    `;

    // --- FRAGMENT SHADER FOR SPIRALS ---
    const fragmentShader = `
      uniform float u_time;
      uniform vec3 u_color_water;
      uniform vec3 u_color_algae_dark;
      uniform vec3 u_color_algae_light;
      varying vec3 v_world_pos;
      varying float v_height;

      vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
      vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; } // FIX: Was 1.o
      vec3 permute(vec3 x) { return mod289(((x*34.0)+1.0)*x); }
      float snoise(vec2 v) {
        const vec4 C = vec4(0.211324865405187, 0.366025403784439, -0.577350269189626, 0.024390243902439);
        vec2 i  = floor(v + dot(v, C.yy) );
        vec2 x0 = v -   i + dot(i, C.xx);
        vec2 i1;
        i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);
        vec4 x12 = x0.xyxy + C.xxzz;
        x12.xy -= i1;
        i = mod289(i);
        vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 )) + i.x + vec3(0.0, i1.x, 1.0 ));
        vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);
        m = m*m;
        m = m*m;
        vec3 x = 2.0 * fract(p * C.www) - 1.0;
        vec3 h = abs(x) - 0.5;
        vec3 ox = floor(x + 0.5);
        vec3 a0 = x - ox;
        m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );
        vec3 g;
        g.x  = a0.x  * x0.x  + h.x  * x0.y;
        g.yz = a0.yz * x12.xz + h.yz * x12.yw;
        return 130.0 * dot(m, g);
      }

      void main() {
        vec2 uv = v_world_pos.xz * 0.005 + u_time * 0.1;
        vec2 warp_offset;
        warp_offset.x = snoise(uv * 1.5 + vec2(1.2, 3.4));
        warp_offset.y = snoise(uv * 1.5 + vec2(5.6, 7.8));
        float distortion_strength = 2.5;
        vec2 warped_uv = uv + warp_offset * distortion_strength;
        float angle = atan(warped_uv.x, warped_uv.y);
        float radius = length(warped_uv);
        float num_arms = 8.0;
        float spiral_value = sin(angle * num_arms + radius * 1.2 - u_time * 2.0);
        float patch_noise = snoise(uv * 0.5 - u_time * 0.05);
        float combined_value = (spiral_value + patch_noise) * 0.5;
        float outer_mask = smoothstep(0.45, 0.75, combined_value);
        float core_mask = smoothstep(0.65, 0.80, combined_value);
        vec3 color = u_color_water;
        color = mix(color, u_color_algae_dark, outer_mask);
        color = mix(color, u_color_algae_light, core_mask);
        float height_factor = smoothstep(-4.0, 4.0, v_height);
        gl_FragColor = vec4(mix(color * 0.7, color, height_factor), 1.0);
      }
    `;

    const mat = new THREE.ShaderMaterial({
      uniforms: {
        u_time: { value: 0.0 },
        u_color_water: { value: new THREE.Color(0x0b2640) },
        u_color_algae_dark: { value: new THREE.Color(0x2d8a6e) },
        u_color_algae_light: { value: new THREE.Color(0x99cc66) },
      },
      vertexShader,
      fragmentShader,
      wireframe: true
    });
    
    const mesh = new THREE.Mesh(geom, mat);
    mesh.scale.set(3.2, 3.2, 3.2);
    scene.add(mesh);

    const pos  = geom.attributes.position;
    const base = pos.array.slice();

    // -------- Resize Handler -------------
    function resize(){
      const w = wrapper.clientWidth;
      const h = wrapper.clientHeight;
      const aspect = w / h;

      renderer.setSize(w, h, false);
      camera.aspect = aspect;

      const baseFov = 75;
      if (aspect > 1.8) { camera.fov = baseFov / (aspect / 1.8); }
      else { camera.fov = baseFov; }

      camera.updateProjectionMatrix();
    }
    new ResizeObserver(resize).observe(wrapper);
    resize();

    // -------- Animate -----------------------
    function animate(t){
      const u_js = t * 0.0001 * FLOW * 50;
      const v_js = t * 0.0001 * FLOW * 35;
      for (let i=0; i < pos.count; i++){
        const ix = i * 3;
        const x0 = base[ix];
        const z0 = base[ix+2];
        const n1 = perlin3(x0 * FREQ - u_js, 0, z0 * FREQ - v_js);
        const n2 = perlin3(x0 * (FREQ * 0.45) + u_js * 0.6, 0, z0 * (FREQ * 0.45) - v_js * 0.6);
        pos.array[ix+1] = (0.7 * n1 + 0.3 * n2) * AMP;
      }
      pos.needsUpdate = true;

      mesh.material.uniforms.u_time.value = t * 0.0001;

      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

  })();
</script>

</body>
</html>